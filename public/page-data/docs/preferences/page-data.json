{"componentChunkName":"component---src-templates-doc-js","path":"/docs/preferences","result":{"data":{"markdownRemark":{"frontmatter":{"title":"Preferences"},"html":"<h1 id=\"首选项偏好设置\" style=\"position:relative;\"><a href=\"#%E9%A6%96%E9%80%89%E9%A1%B9%E5%81%8F%E5%A5%BD%E8%AE%BE%E7%BD%AE\" aria-label=\"首选项偏好设置 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>首选项（偏好设置）</h1>\n<p>Theia 带有首选项服务，它允许模块从中获取偏好设置、扩展默认偏好并监听其变化。</p>\n<p>首选项可以保存在工作区的根目录下 <code class=\"language-text\">.theia/settings.json</code> 或 Linux 系统的 <code class=\"language-text\">$HOME/.theia/settings.json</code> 下。对于 Windows 系统，用户设置默认在 <code class=\"language-text\">%USERPROFILE%/.theia/settings.json</code>（类似于<code class=\"language-text\">C:\\Users\\epatpol\\.theia/settings.json</code>）。</p>\n<p>偏好设置是标准的 key、value 结构 JSON 文件（注意，以下偏好设置名称不是官方的，只是作为一个例子）。如果需要，你也可以在 settings.json 文件中添加注释，例如</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">{\n    // Enable/Disable the line numbers in the monaco editor\n\t\"monaco.lineNumbers\": \"off\",\n    // Tab width in the editor\n\t\"monaco.tabWidth\": 4,\n\t\"fs.watcherExcludes\": \"path/to/file\"\n}</code></pre></div>\n<p>下面以文件系统为例，讲解偏好设置的使用。</p>\n<h2 id=\"用-inversify-将默认偏好作为模块贡献出来\" style=\"position:relative;\"><a href=\"#%E7%94%A8-inversify-%E5%B0%86%E9%BB%98%E8%AE%A4%E5%81%8F%E5%A5%BD%E4%BD%9C%E4%B8%BA%E6%A8%A1%E5%9D%97%E8%B4%A1%E7%8C%AE%E5%87%BA%E6%9D%A5\" aria-label=\"用 inversify 将默认偏好作为模块贡献出来 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>用 inversify 将默认偏好作为模块贡献出来</h2>\n<p>如要添加偏好设置，模块必须提供一个有效的 json schema，该 schema 用来验证偏好值。一个模块必须像下面这样把 PreferenceContribution 绑定到一个值。</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">PreferenceSchema</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">[</span>name<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> Object<span class=\"token punctuation\">,</span>\n    properties<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token punctuation\">[</span>name<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> object\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">PreferenceContribution</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">readonly</span> schema<span class=\"token operator\">:</span> PreferenceSchema<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>作为示例，文件系统做如下绑定：</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> filesystemPreferenceSchema<span class=\"token operator\">:</span> PreferenceSchema <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string-property property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"object\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"properties\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string-property property\">\"files.watcherExclude\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token string-property property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"List of paths to exclude from the filesystem watcher\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string-property property\">\"additionalProperties\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token string-property property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"boolean\"</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>PreferenceContribution<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toConstantValue</span><span class=\"token punctuation\">(</span>\n<span class=\"token punctuation\">{</span>\n    schema<span class=\"token operator\">:</span> filesystemPreferenceSchema\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>这里有一些辅助链接帮你创建有效的 schema:</p>\n<ul>\n<li><a href=\"http://json-schema.org/documentation.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">JSON schema spec</a></li>\n<li><a href=\"https://jsonlint.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Online JSON validator</a></li>\n<li><a href=\"http://www.jsonschemavalidator.net/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Online JSON schema validator</a></li>\n</ul>\n<h2 id=\"通过偏好设置来监听首选项的变化\" style=\"position:relative;\"><a href=\"#%E9%80%9A%E8%BF%87%E5%81%8F%E5%A5%BD%E8%AE%BE%E7%BD%AE%E6%9D%A5%E7%9B%91%E5%90%AC%E9%A6%96%E9%80%89%E9%A1%B9%E7%9A%84%E5%8F%98%E5%8C%96\" aria-label=\"通过偏好设置来监听首选项的变化 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>通过偏好设置来监听首选项的变化</h2>\n<p>要获取首选项的值，只需从容器中获取注入的 PreferenceService 即可：</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> preferences <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">.</span>container<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>PreferenceService<span class=\"token punctuation\">)</span></code></pre></div>\n<p>在文件系统的示例中，首选项服务是开始时加载获取的，这种情况下，你可以使用 onPreferenceChanged 方法来注册最及时响应的 change 回调。</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">inject</span></span><span class=\"token punctuation\">(</span>PreferenceService<span class=\"token punctuation\">)</span> <span class=\"token keyword\">protected</span> <span class=\"token keyword\">readonly</span> prefService<span class=\"token operator\">:</span> PreferenceService\n\tprefService<span class=\"token punctuation\">.</span><span class=\"token function\">onPreferenceChanged</span><span class=\"token punctuation\">(</span>e <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span> callback <span class=\"token punctuation\">}</span></code></pre></div>\n<p>回调将收到如下格式的事件响应 <code class=\"language-text\">e</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">PreferenceChangedEvent</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">readonly</span> preferenceName<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">readonly</span> newValue<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">readonly</span> oldValue<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>虽然向上述一样，可以直接在需要的类中使用，而文件系统也提供了一个专门针对文件系统偏好的代理服务（它在后台使用偏好设置服务）。这样可以更快更有效地搜索偏好（因为是在文件系统偏好服务范围内搜索偏好，而不是经通用的偏好服务在所有偏好上搜索），从而更加高效，因为只有监听特定偏好的模块会被通知。为了做到这一点，有一个文件系统配置的代理接口，像这样使用首选项代理接口进行绑定：</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">type</span> <span class=\"token class-name\">PreferenceProxy<span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span><span class=\"token operator\">></span></span> <span class=\"token operator\">=</span> Readonly<span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span><span class=\"token operator\">></span> <span class=\"token operator\">&amp;</span> Disposable <span class=\"token operator\">&amp;</span> PreferenceEventEmitter<span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token generic-function\"><span class=\"token function\">createPreferenceProxy</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span> <span class=\"token keyword\">extends</span> Configuration<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>preferences<span class=\"token operator\">:</span> PreferenceService<span class=\"token punctuation\">,</span> configuration<span class=\"token operator\">:</span> <span class=\"token constant\">T</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> PreferenceProxy<span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* Register a client to the preference server\n    When a preference is received, it is validated against the schema and then fired if valid, otherwise the default value is provided.\n\n    This proxy is also in charge of calling the configured preference service when the proxy object is called i.e editorPrefs['preferenceName']\n\n    It basically forwards methods to the real object, i.e dispose/ready etc.\n}</span></code></pre></div>\n<p>要使用该代理，只需将其绑定到新的类型 X = PreferenceProxy&#x3C;CONFIGURATION_INTERFACE>，然后用 bind(X) 绑定代理。</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">FileSystemConfiguration</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string-property property\">'files.watcherExclude'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">[</span>globPattern<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> FileSystemPreferences <span class=\"token operator\">=</span> <span class=\"token function\">Symbol</span><span class=\"token punctuation\">(</span><span class=\"token string\">'FileSystemPreferences'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">type</span> <span class=\"token class-name\">FileSystemPreferences</span> <span class=\"token operator\">=</span> PreferenceProxy<span class=\"token operator\">&lt;</span>FileSystemConfiguration<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">createFileSystemPreferences</span><span class=\"token punctuation\">(</span>preferences<span class=\"token operator\">:</span> PreferenceService<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> FileSystemPreferences <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">createPreferenceProxy</span><span class=\"token punctuation\">(</span>preferences<span class=\"token punctuation\">,</span> defaultFileSystemConfiguration<span class=\"token punctuation\">,</span> filesystemPreferenceSchema<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">bindFileSystemPreferences</span><span class=\"token punctuation\">(</span>bind<span class=\"token operator\">:</span> interfaces<span class=\"token punctuation\">.</span>Bind<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>FileSystemPreferences<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toDynamicValue</span><span class=\"token punctuation\">(</span>ctx <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> preferences <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">.</span>container<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>PreferenceService<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">createFileSystemPreferences</span><span class=\"token punctuation\">(</span>preferences<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>PreferenceContribution<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toConstantValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> schema<span class=\"token operator\">:</span> filesystemPreferenceSchema <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>最后，要使用文件系统的偏好配置，只需在需要的地方将它注入，你可以像这样访问偏好设置（仍以文件系统为例）：</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> patterns <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>preferences<span class=\"token punctuation\">[</span><span class=\"token string\">'files.watcherExclude'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>你也可以像这样注册对偏好设置的监听：</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>toDispose<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>preferences<span class=\"token punctuation\">.</span><span class=\"token function\">onPreferenceChanged</span><span class=\"token punctuation\">(</span>e <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>preferenceName <span class=\"token operator\">===</span> <span class=\"token string\">'files.watcherExclude'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>toRestartAll<span class=\"token punctuation\">.</span><span class=\"token function\">dispose</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span><span class=\"token punctuation\">,</span>\n        <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">inject</span></span><span class=\"token punctuation\">(</span>FileSystemPreferences<span class=\"token punctuation\">)</span> <span class=\"token keyword\">protected</span> <span class=\"token keyword\">readonly</span> preferences<span class=\"token operator\">:</span> FileSystemPreferences<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token operator\">...</span>\n         <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>toDispose<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>preferences<span class=\"token punctuation\">.</span><span class=\"token function\">onPreferenceChanged</span><span class=\"token punctuation\">(</span>e <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>preferenceName <span class=\"token operator\">===</span> <span class=\"token string\">'files.watcherExclude'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>toRestartAll<span class=\"token punctuation\">.</span><span class=\"token function\">dispose</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"preference-flow-when-modifying-a-preference-修改首选项时的首选项流程\" style=\"position:relative;\"><a href=\"#preference-flow-when-modifying-a-preference-%E4%BF%AE%E6%94%B9%E9%A6%96%E9%80%89%E9%A1%B9%E6%97%B6%E7%9A%84%E9%A6%96%E9%80%89%E9%A1%B9%E6%B5%81%E7%A8%8B\" aria-label=\"preference flow when modifying a preference 修改首选项时的首选项流程 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Preference flow when modifying a preference 修改首选项时的首选项流程</h2>\n<p>目前，当 ${workspace}/.theia/ 或 <code class=\"language-text\">os.homedir()</code>/.theia/ 中的 settings.json 被修改时，会触发偏好服务修改事件。目前，用 CompoundPreferenceServer 来管理不同服务（作用域），如 workspace/user/defaults（通过上述示例提供）。接下来，改用 PreferenceService 来管理，它上面添加了更方便的 api（如getBoolean、getString等）。它还允许客户端注册偏好设置的监听。PreferenceService 可直接在模块中注入使用，或通过更具体的代理（如上面的文件系统配置）。</p>\n<p>当偏好设置修改时，流程如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">.theia/settings.json -> JsonPreferenceServer -> CompoundPreferenceServer -> PreferenceService -> PreferenceProxy&lt;FileSystemConfiguration> -> FileSystemWatcher</code></pre></div>\n<h2 id=\"获取偏好设置\" style=\"position:relative;\"><a href=\"#%E8%8E%B7%E5%8F%96%E5%81%8F%E5%A5%BD%E8%AE%BE%E7%BD%AE\" aria-label=\"获取偏好设置 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>获取偏好设置</h2>\n<p>在文件系统的例子中，我们将使用与上述相同的代理配置来访问偏好设置：</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\">    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>prefService<span class=\"token punctuation\">[</span><span class=\"token string\">'preferenceName'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>prefService<span class=\"token punctuation\">[</span><span class=\"token string\">'preferenceName2'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>这样做的原因是，如上所述，代理将直接调用 prefService.get('preferenceName')。</p>\n<h2 id=\"首选项-todofixme\" style=\"position:relative;\"><a href=\"#%E9%A6%96%E9%80%89%E9%A1%B9-todofixme\" aria-label=\"首选项 todofixme permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>首选项 TODO/FIXME</h2>\n<ul>\n<li>在 CompoundPreferenceServer 中添加具有不同优先级的作用域</li>\n<li>在 theia 内部修改 settings.json 时，增加自动补全</li>\n</ul>","fields":{"slug":"preferences"}}},"pageContext":{"slug":"preferences"}},"staticQueryHashes":["2468095761"]}